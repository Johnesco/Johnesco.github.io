<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>John Escobedo - Plain Text Resume</title>
    <style>
        body {
            font-family: monospace;
            line-height: 1.4;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            white-space: pre-line;
        }
        h1, h2 {
            border-bottom: 1px solid #ccc;
            padding-bottom: 0.5rem;
        }
        .section {
            margin-bottom: 2rem;
        }
        .job {
            margin-bottom: 1.5rem;
            page-break-inside: avoid;
        }
        .highlight {
            margin-left: 2rem;
        }
        @media print {
            body { margin: 0; padding: 0; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>
    <div id="resume-content">
        Loading resume...
    </div>
    <p class="no-print">
        <a id="back-link" href="index.html">‚Üê Back to formatted resume</a>
    </p>
    
    <script src="js/resumeJSON.js"></script>
    <script>
        // URL Query Parameter Utilities
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                tags: params.get('tags') ? params.get('tags').split(',').map(t => t.trim().toLowerCase()) : null,
                years: params.get('years') ? parseInt(params.get('years'), 10) : null,
                skills: params.get('skills') ? params.get('skills').split(',').map(s => s.trim().toLowerCase()) : null
            };
        }

        function filterWorkByTags(work, tags) {
            if (!tags || tags.length === 0) return work;
            return work.filter(job => {
                if (!job.tags || job.tags.length === 0) return false;
                return job.tags.some(tag => tags.includes(tag.toLowerCase()));
            });
        }

        function filterWorkByYears(work, years = 10) {
            if (years <= 0 || years > 50) return work;
            const now = new Date();
            const cutoffDate = new Date(now.getFullYear() - years, now.getMonth(), now.getDate());

            return work.filter(job => {
                const dateStr = job.endDate || job.startDate;
                if (!dateStr) return true;

                const parts = dateStr.split('-');
                if (parts.length < 2) return true;

                const jobDate = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parts[2] ? parseInt(parts[2]) : 1);
                return jobDate >= cutoffDate;
            });
        }

        function filterSkills(skills, skillFilter) {
            if (!skillFilter || skillFilter.length === 0) return skills;
            return skills.filter(skill => {
                const skillName = skill.name.toLowerCase();
                return skillFilter.some(filter => skillName.includes(filter));
            });
        }

        function updateBackLink() {
            const link = document.getElementById('back-link');
            if (!link) return;
            const currentSearch = window.location.search;
            link.href = 'index.html' + currentSearch;
        }

        // Plain text rendering logic
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof resumeJSON !== 'undefined') {
                renderPlainTextResume();
                updateBackLink();
            }
        });
        
        function oxfordComma(array) {
            if (!array || array.length === 0) return '';
            if (array.length === 1) return array[0] + '.';
            if (array.length === 2) return array[0] + ' and ' + array[1] + '.';
            const last = array[array.length - 1];
            const rest = array.slice(0, -1);
            return rest.join(', ') + ', and ' + last + '.';
        }
        
        function formatDate(inputDate) {
            if (!inputDate) return 'Present';
            const parts = inputDate.split('-');
            if (parts.length !== 3) return inputDate;
            const year = parts[0];
            const month = parseInt(parts[1], 10) - 1;
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            if (month < 0 || month > 11) return inputDate;
            return monthNames[month] + ' ' + year;
        }
        
        function renderPlainTextResume() {
            const content = document.getElementById('resume-content');
            let html = '';

            // Get query parameters and apply filters
            const params = getQueryParams();
            let filteredWork = resumeJSON.work;
            let filteredSkills = resumeJSON.skills;

            filteredWork = filterWorkByTags(filteredWork, params.tags);
            // Default to 10 years if no years parameter specified
            const yearsFilter = params.years !== undefined ? params.years : 10;
            filteredWork = filterWorkByYears(filteredWork, yearsFilter);
            filteredSkills = filterSkills(filteredSkills, params.skills);

            // Header
            html += `NAME: ${resumeJSON.basics.name}\n`;
            html += `TITLE: ${resumeJSON.basics.label}\n`;
            html += `EMAIL: ${resumeJSON.basics.email}\n`;
            html += `PHONE: ${resumeJSON.basics.phone}\n`;
            html += `LOCATION: ${resumeJSON.basics.location.city}, ${resumeJSON.basics.location.region} ${resumeJSON.basics.location.postalCode}\n`;
            html += '\n';

            // Summary
            html += `PROFESSIONAL SUMMARY:\n${resumeJSON.basics.summary}\n\n`;

            // Skills (filtered)
            html += '\n\n';
            html += 'SKILL SETS\n';
            html += '\n\n';
            filteredSkills.forEach(skill => {
                html += `${skill.name}:\n`;
                html += `${oxfordComma(skill.keywords)}\n\n`;
            });

            // Work Experience (filtered)
            html += '\n\n';
            html += 'WORK EXPERIENCE\n';
            html += '\n\n';
            filteredWork.forEach(job => {
                const startDate = formatDate(job.startDate);
                const endDate = job.endDate ? formatDate(job.endDate) : 'Present';
                
                html += `COMPANY: ${job.name}\n`;
                html += `LOCATION: ${job.location}\n`;
                html += `POSITION: ${job.position}\n`;
                html += `DATES: ${startDate} - ${endDate}\n\n`;
                html += `SUMMARY: ${job.summary}\n\n`;
                html += `RESPONSIBILITIES AND ACCOMPLISHMENTS:\n`;
                job.highlights.forEach(highlight => {
                    if (highlight.charAt(0) === ' ') {
                        html += '\n';
                    }
                    html += `  * ${highlight.trim()}\n`;
                });
                html += '\n\n';
            });
            
            // Education
            
            html += 'EDUCATION AND TRAINING\n';
            html += '\n\n';
            resumeJSON.education.forEach(school => {
                html += `INSTITUTION: ${school.institution}\n`;
                html += `DATES: ${school.startDate} - ${school.endDate}\n`;
                html += `AREA OF STUDY: ${school.area}\n\n`;
            });
            
            // Footer
            html += '\n' + '\n';
            html += 'For the most recent version of this resume, visit:\n';
            html += 'https://johnesco.github.io/resume/\n';
            
            content.textContent = html;
        }
    </script>
</body>
</html>