<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>John Escobedo - Plain Text Resume</title>
    <style>
        body {
            font-family: monospace;
            line-height: 1.4;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            white-space: pre-line;
        }
        h1, h2 {
            border-bottom: 1px solid #ccc;
            padding-bottom: 0.5rem;
        }
        .section {
            margin-bottom: 2rem;
        }
        .job {
            margin-bottom: 1.5rem;
            page-break-inside: avoid;
        }
        .highlight {
            margin-left: 2rem;
        }
        .filter-info {
            background-color: #f0f0f0;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border-left: 3px solid #1144cc;
        }
        @media print {
            body { margin: 0; padding: 0; }
            .no-print { display: none; }
            .filter-info { background-color: transparent; border: 1px solid #ccc; }
        }
    </style>
</head>
<body>
    <div id="resume-content">
        Loading resume...
    </div>
    <p class="no-print">
        <a href="index.html">‚Üê Back to formatted resume</a>
    </p>
    
    <script src="js/resumeJSON.js"></script>
    <script>
        // Plain text rendering logic
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof resumeJSON !== 'undefined') {
                renderPlainTextResume();
            }
        });
        
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                timeframe: params.get('timeframe') || 'all'
            };
        }
        
        function oxfordComma(array) {
            if (!array || array.length === 0) return '';
            if (array.length === 1) return array[0] + '.';
            if (array.length === 2) return array[0] + ' and ' + array[1] + '.';
            const last = array[array.length - 1];
            const rest = array.slice(0, -1);
            return rest.join(', ') + ', and ' + last + '.';
        }
        
        function formatDate(inputDate) {
            if (!inputDate) return 'Present';
            const parts = inputDate.split('-');
            if (parts.length !== 3) return inputDate;
            const year = parts[0];
            const month = parseInt(parts[1], 10) - 1;
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            if (month < 0 || month > 11) return inputDate;
            return monthNames[month] + ' ' + year;
        }
        
        function filterWorkExperience(workArray, timeframe) {
            if (timeframe === 'all') return workArray;
            
            const now = new Date();
            const cutoffDate = new Date();
            
            switch(timeframe) {
                case '10y':
                    cutoffDate.setFullYear(now.getFullYear() - 10);
                    break;
                case '5y':
                    cutoffDate.setFullYear(now.getFullYear() - 5);
                    break;
                case 'current':
                    return [workArray[0]]; // Only most recent job
            }
            
            return workArray.filter(job => {
                const jobStartDate = new Date(job.startDate);
                return jobStartDate >= cutoffDate;
            });
        }
        
        function getFilterMessage(timeframe, filteredCount, totalCount) {
            const messages = {
                'all': `Full career history (${totalCount} positions)`,
                '10y': `Last 10 years of experience (${filteredCount} of ${totalCount} positions)`,
                '5y': `Last 5 years of experience (${filteredCount} of ${totalCount} positions)`,
                'current': `Current position only (1 of ${totalCount} positions)`
            };
            return messages[timeframe] || messages.all;
        }
        
        function renderPlainTextResume() {
            const content = document.getElementById('resume-content');
            let html = '';
            
            // Get query parameters
            const queryParams = getQueryParams();
            
            // Filter work experience based on query parameter
            const filteredWork = filterWorkExperience(resumeJSON.work, queryParams.timeframe);
            const filteredCount = filteredWork.length;
            const totalCount = resumeJSON.work.length;
            
            // Header
            html += `NAME: ${resumeJSON.basics.name}\n`;
            html += `TITLE: ${resumeJSON.basics.label}\n`;
            html += `EMAIL: ${resumeJSON.basics.email}\n`;
            html += `PHONE: ${resumeJSON.basics.phone}\n`;
            html += `LOCATION: ${resumeJSON.basics.location.city}, ${resumeJSON.basics.location.region} ${resumeJSON.basics.location.postalCode}\n`;
            html += '\n';
            
            // Filter information
            if (queryParams.timeframe !== 'all') {
                html += 'FILTER: ' + getFilterMessage(queryParams.timeframe, filteredCount, totalCount) + '\n';
                html += 'URL PARAMETER: ?timeframe=' + queryParams.timeframe + '\n\n';
            }
            
            // Summary
            html += `PROFESSIONAL SUMMARY:\n${resumeJSON.basics.summary}\n\n`;
            
            // Skills
            html += '\n\n';
            html += 'SKILL SETS\n';
            html += '\n\n';
            resumeJSON.skills.forEach(skill => {
                html += `${skill.name}:\n`;
                html += `${oxfordComma(skill.keywords)}\n\n`;
            });
            
            // Work Experience
            html += '\n\n';
            html += 'WORK EXPERIENCE\n';
            html += '\n\n';
            
            filteredWork.forEach(job => {
                const startDate = formatDate(job.startDate);
                const endDate = job.endDate ? formatDate(job.endDate) : 'Present';
                
                html += `COMPANY: ${job.name}\n`;
                html += `LOCATION: ${job.location}\n`;
                html += `POSITION: ${job.position}\n`;
                html += `DATES: ${startDate} - ${endDate}\n\n`;
                html += `SUMMARY: ${job.summary}\n\n`;
                html += `RESPONSIBILITIES AND ACCOMPLISHMENTS:\n`;
                job.highlights.forEach(highlight => {
                    if (highlight.charAt(0) === ' ') {
                        html += '\n';
                    }
                    html += `  * ${highlight.trim()}\n`;
                });
                html += '\n\n';
            });
            
            // Education
            html += 'EDUCATION AND TRAINING\n';
            html += '\n\n';
            resumeJSON.education.forEach(school => {
                html += `INSTITUTION: ${school.institution}\n`;
                html += `DATES: ${school.startDate} - ${school.endDate}\n`;
                html += `AREA OF STUDY: ${school.area}\n\n`;
            });
            
            // Footer with filter info if applicable
            html += '\n\n';
            if (queryParams.timeframe !== 'all') {
                html += 'NOTE: This view is filtered. For full career history, visit:\n';
                html += 'https://johnesco.github.io/resume/?timeframe=all\n\n';
            } else {
                html += 'For different timeframes, use these URLs:\n';
                html += 'Last 10 years: https://johnesco.github.io/resume/?timeframe=10y\n';
                html += 'Last 5 years:  https://johnesco.github.io/resume/?timeframe=5y\n';
                html += 'Current only:   https://johnesco.github.io/resume/?timeframe=current\n\n';
            }
            
            html += 'For the most recent version of this resume, visit:\n';
            html += 'https://johnesco.github.io/resume/\n';
            
            content.textContent = html;
        }
    </script>
</body>
</html>