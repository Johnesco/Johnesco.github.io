(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();var n=(s=>(s.SET="SET",s.TO="TO",s.IF="IF",s.THEN="THEN",s.ELSE="ELSE",s.END="END",s.FUNCTION="FUNCTION",s.TAKING="TAKING",s.WITH="WITH",s.REPEAT="REPEAT",s.TIMES="TIMES",s.WHILE="WHILE",s.FOR="FOR",s.EACH="EACH",s.IN="IN",s.DO="DO",s.RETURN="RETURN",s.AND="AND",s.OR="OR",s.NOT="NOT",s.IS="IS",s.EQUAL="EQUAL",s.GREATER="GREATER",s.LESS="LESS",s.THAN="THAN",s.PLUS="PLUS",s.MINUS="MINUS",s.TIMES_OP="TIMES_OP",s.DIVIDED="DIVIDED",s.BY="BY",s.MOD="MOD",s.JOINED="JOINED",s.LIST="LIST",s.OF="OF",s.ITEM="ITEM",s.YES="YES",s.NO="NO",s.PRINT="PRINT",s.DRAW="DRAW",s.CIRCLE="CIRCLE",s.RECTANGLE="RECTANGLE",s.LINE="LINE",s.AT="AT",s.FROM="FROM",s.RADIUS="RADIUS",s.WIDTH="WIDTH",s.HEIGHT="HEIGHT",s.COLOR="COLOR",s.CLEAR="CLEAR",s.CANVAS="CANVAS",s.NUMBER="NUMBER",s.STRING="STRING",s.IDENTIFIER="IDENTIFIER",s.COMMA="COMMA",s.PLUS_SYMBOL="PLUS_SYMBOL",s.MINUS_SYMBOL="MINUS_SYMBOL",s.STAR="STAR",s.SLASH="SLASH",s.NEWLINE="NEWLINE",s.EOF="EOF",s))(n||{});class u extends Error{constructor(e,t,i,r){super(e),this.name="ClearError",this.line=t,this.column=i,this.hint=r}format(e){let t=`Error on line ${this.line}: ${this.message}`;if(e){const r=e.split(`
`)[this.line-1];r&&(t+=`

`,t+=`  ${this.line} | ${r}
`,t+=`  ${" ".repeat(String(this.line).length)} | ${" ".repeat(this.column-1)}^`)}return this.hint&&(t+=`

Hint: ${this.hint}`),t}}class l extends u{constructor(e,t,i,r){super(e,t,i,r),this.name="ParseError"}}class o extends u{constructor(e,t,i=1,r){super(e,t,i,r),this.name="RuntimeError"}}function y(s,e){const t=s.toLowerCase(),i=e.filter(c=>c.startsWith(t));if(i.length===1)return i[0];let r=null,a=1/0;for(const c of e){const h=I(t,c.toLowerCase());h<a&&h<=2&&(a=h,r=c)}return r}function I(s,e){const t=[];for(let i=0;i<=e.length;i++)t[i]=[i];for(let i=0;i<=s.length;i++)t[0][i]=i;for(let i=1;i<=e.length;i++)for(let r=1;r<=s.length;r++)e[i-1]===s[r-1]?t[i][r]=t[i-1][r-1]:t[i][r]=Math.min(t[i-1][r-1]+1,t[i][r-1]+1,t[i-1][r]+1);return t[e.length][s.length]}const g={set:n.SET,to:n.TO,if:n.IF,then:n.THEN,else:n.ELSE,end:n.END,function:n.FUNCTION,taking:n.TAKING,with:n.WITH,repeat:n.REPEAT,times:n.TIMES,while:n.WHILE,for:n.FOR,each:n.EACH,in:n.IN,do:n.DO,return:n.RETURN,and:n.AND,or:n.OR,not:n.NOT,is:n.IS,equal:n.EQUAL,greater:n.GREATER,less:n.LESS,than:n.THAN,plus:n.PLUS,minus:n.MINUS,divided:n.DIVIDED,by:n.BY,mod:n.MOD,joined:n.JOINED,list:n.LIST,of:n.OF,item:n.ITEM,yes:n.YES,no:n.NO,print:n.PRINT,draw:n.DRAW,circle:n.CIRCLE,rectangle:n.RECTANGLE,line:n.LINE,at:n.AT,from:n.FROM,radius:n.RADIUS,width:n.WIDTH,height:n.HEIGHT,color:n.COLOR,clear:n.CLEAR,canvas:n.CANVAS};class N{constructor(e){this.tokens=[],this.start=0,this.current=0,this.line=1,this.column=1,this.lineStart=0,this.source=e}tokenize(){for(;!this.isAtEnd();)this.start=this.current,this.scanToken();return this.tokens.push({type:n.EOF,value:"",line:this.line,column:this.column}),this.tokens}scanToken(){const e=this.advance();switch(e){case" ":case"\r":case"	":break;case`
`:this.addToken(n.NEWLINE,"\\n"),this.line++,this.lineStart=this.current,this.column=1;break;case",":this.addToken(n.COMMA,",");break;case"+":this.addToken(n.PLUS_SYMBOL,"+");break;case"-":this.addToken(n.MINUS_SYMBOL,"-");break;case"*":this.addToken(n.STAR,"*");break;case"/":this.addToken(n.SLASH,"/");break;case'"':this.string();break;default:if(this.isDigit(e))this.number();else if(this.isAlpha(e))this.identifier();else throw new u(`I don't recognize the character '${e}'`,this.line,this.column-1)}}string(){const e=this.line,t=this.column-1;for(;this.peek()!=='"'&&!this.isAtEnd();)this.peek()===`
`&&(this.line++,this.column=1),this.advance();if(this.isAtEnd())throw new u('I found a string that was never closed. Add a " at the end.',e,t);this.advance();const i=this.source.slice(this.start+1,this.current-1);this.addToken(n.STRING,i)}number(){for(;this.isDigit(this.peek());)this.advance();if(this.peek()==="."&&this.isDigit(this.peekNext()))for(this.advance();this.isDigit(this.peek());)this.advance();const e=this.source.slice(this.start,this.current);this.addToken(n.NUMBER,e)}identifier(){for(;this.isAlphaNumeric(this.peek());)this.advance();const e=this.source.slice(this.start,this.current).toLowerCase();if(e==="note"&&this.peek()===":"){for(this.advance();this.peek()!==`
`&&!this.isAtEnd();)this.advance();return}const t=g[e]??n.IDENTIFIER;this.addToken(t,e)}isAtEnd(){return this.current>=this.source.length}advance(){return this.column++,this.source[this.current++]}peek(){return this.isAtEnd()?"\0":this.source[this.current]}peekNext(){return this.current+1>=this.source.length?"\0":this.source[this.current+1]}isDigit(e){return e>="0"&&e<="9"}isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_"}isAlphaNumeric(e){return this.isAlpha(e)||this.isDigit(e)}addToken(e,t){this.tokens.push({type:e,value:t,line:this.line,column:this.column-t.length})}}function x(s){return new N(s).tokenize()}class k{constructor(e){this.current=0,this.tokens=e.filter(t=>t.type!==n.NEWLINE)}parse(){const e=[];for(;!this.isAtEnd();){const t=this.parseStatement();t&&e.push(t)}return{type:"Program",statements:e}}parseStatement(){for(;this.check(n.NEWLINE);)this.advance();if(this.isAtEnd())return null;if(this.check(n.SET))return this.parseSetStatement();if(this.check(n.IF))return this.parseIfStatement();if(this.check(n.REPEAT))return this.parseRepeatStatement();if(this.check(n.FOR))return this.parseForEachStatement();if(this.check(n.FUNCTION))return this.parseFunctionDeclaration();if(this.check(n.RETURN))return this.parseReturnStatement();if(this.check(n.PRINT))return this.parsePrintStatement();if(this.check(n.DRAW))return this.parseDrawStatement();if(this.check(n.CLEAR))return this.parseClearCanvasStatement();if(this.check(n.IDENTIFIER)){const t=this.peekNext();return t&&t.type===n.WITH?this.parseFunctionCallStatement():this.parseFunctionCallStatement()}const e=this.peek();throw new l(`I don't know how to handle '${e.value}' here`,e.line,e.column,"Statements usually start with: set, if, repeat, for, function, print, or draw")}parseSetStatement(){const e=this.consume(n.SET,"Expected 'set'");if(this.check(n.COLOR))return this.advance(),this.consume(n.TO,"Expected 'to' after 'set color'"),{type:"SetColorStatement",color:this.parseExpression(),line:e.line};const t=this.consume(n.IDENTIFIER,"Expected a variable name after 'set'");this.consume(n.TO,`Expected 'to' after 'set ${t.value}'`);const i=this.parseExpression();return{type:"SetStatement",identifier:t.value,value:i,line:e.line}}parseIfStatement(){const e=this.consume(n.IF,"Expected 'if'"),t=this.parseExpression();this.consume(n.THEN,"Expected 'then' after the condition");const i=[];for(;!this.check(n.END)&&!this.check(n.ELSE)&&!this.isAtEnd();){const a=this.parseStatement();a&&i.push(a)}let r=null;if(this.check(n.ELSE))for(this.advance(),r=[];!this.check(n.END)&&!this.isAtEnd();){const a=this.parseStatement();a&&r.push(a)}return this.consume(n.END,"Expected 'end' to close the if statement"),this.consume(n.IF,"Expected 'if' after 'end' (write 'end if')"),{type:"IfStatement",condition:t,thenBranch:i,elseBranch:r,line:e.line}}parseRepeatStatement(){const e=this.consume(n.REPEAT,"Expected 'repeat'");if(this.check(n.WHILE)){this.advance();const r=this.parseExpression(),a=[];for(;!this.check(n.END)&&!this.isAtEnd();){const c=this.parseStatement();c&&a.push(c)}return this.consume(n.END,"Expected 'end' to close the repeat loop"),this.consume(n.REPEAT,"Expected 'repeat' after 'end' (write 'end repeat')"),{type:"RepeatWhileStatement",condition:r,body:a,line:e.line}}const t=this.parseExpression();this.consume(n.TIMES,"Expected 'times' after the number");const i=[];for(;!this.check(n.END)&&!this.isAtEnd();){const r=this.parseStatement();r&&i.push(r)}return this.consume(n.END,"Expected 'end' to close the repeat loop"),this.consume(n.REPEAT,"Expected 'repeat' after 'end' (write 'end repeat')"),{type:"RepeatTimesStatement",count:t,body:i,line:e.line}}parseForEachStatement(){const e=this.consume(n.FOR,"Expected 'for'");this.consume(n.EACH,"Expected 'each' after 'for'");const t=this.consume(n.IDENTIFIER,"Expected a variable name after 'for each'");this.consume(n.IN,`Expected 'in' after 'for each ${t.value}'`);const i=this.parseExpression();this.consume(n.DO,"Expected 'do' before the loop body");const r=[];for(;!this.check(n.END)&&!this.isAtEnd();){const a=this.parseStatement();a&&r.push(a)}return this.consume(n.END,"Expected 'end' to close the for loop"),this.consume(n.FOR,"Expected 'for' after 'end' (write 'end for')"),{type:"ForEachStatement",variable:t.value,iterable:i,body:r,line:e.line}}parseFunctionDeclaration(){const e=this.consume(n.FUNCTION,"Expected 'function'"),t=this.consume(n.IDENTIFIER,"Expected a function name after 'function'"),i=[];if(this.check(n.TAKING))for(this.advance();this.check(n.IDENTIFIER);)i.push(this.advance().value),this.check(n.COMMA)&&this.advance(),this.check(n.AND)&&this.advance();const r=[];for(;!this.check(n.END)&&!this.isAtEnd();){const a=this.parseStatement();a&&r.push(a)}return this.consume(n.END,"Expected 'end' to close the function"),this.consume(n.FUNCTION,"Expected 'function' after 'end' (write 'end function')"),{type:"FunctionDeclaration",name:t.value,parameters:i,body:r,line:e.line}}parseFunctionCallStatement(){const e=this.parseFunctionCallExpression();return{type:"FunctionCallStatement",call:e,line:e.arguments.length>0?this.previous().line:this.peek().line}}parseFunctionCallExpression(){const e=this.consume(n.IDENTIFIER,"Expected function name"),t=[];if(this.check(n.WITH)){this.advance();do t.push(this.parseExpression()),this.check(n.COMMA)&&this.advance(),this.check(n.AND)&&this.advance();while(!this.isAtEnd()&&!this.checkStatementStart()&&!this.check(n.END)&&!this.check(n.ELSE)&&!this.check(n.THEN))}return{type:"FunctionCallExpression",name:e.value,arguments:t}}parseReturnStatement(){const e=this.consume(n.RETURN,"Expected 'return'");let t=null;return!this.checkStatementStart()&&!this.check(n.END)&&(t=this.parseExpression()),{type:"ReturnStatement",value:t,line:e.line}}parsePrintStatement(){const e=this.consume(n.PRINT,"Expected 'print'");return{type:"PrintStatement",value:this.parseExpression(),line:e.line}}parseDrawStatement(){const e=this.consume(n.DRAW,"Expected 'draw'"),t={};if(this.check(n.CIRCLE))return this.advance(),this.consume(n.AT,"Expected 'at' after 'draw circle'"),t.x=this.parseExpression(),this.consumeOptionalComma(),t.y=this.parseExpression(),this.consume(n.WITH,"Expected 'with' before radius"),this.consume(n.RADIUS,"Expected 'radius'"),t.radius=this.parseExpression(),{type:"DrawStatement",shape:"circle",params:t,line:e.line};if(this.check(n.RECTANGLE))return this.advance(),this.consume(n.AT,"Expected 'at' after 'draw rectangle'"),t.x=this.parseExpression(),this.consumeOptionalComma(),t.y=this.parseExpression(),this.consume(n.WITH,"Expected 'with' before dimensions"),this.consume(n.WIDTH,"Expected 'width'"),t.width=this.parseExpression(),this.check(n.AND)&&this.advance(),this.consume(n.HEIGHT,"Expected 'height'"),t.height=this.parseExpression(),{type:"DrawStatement",shape:"rectangle",params:t,line:e.line};if(this.check(n.LINE))return this.advance(),this.consume(n.FROM,"Expected 'from' after 'draw line'"),t.x1=this.parseExpression(),this.consumeOptionalComma(),t.y1=this.parseExpression(),this.consume(n.TO,"Expected 'to' in 'draw line from x1, y1 to x2, y2'"),t.x2=this.parseExpression(),this.consumeOptionalComma(),t.y2=this.parseExpression(),{type:"DrawStatement",shape:"line",params:t,line:e.line};throw new l("Expected 'circle', 'rectangle', or 'line' after 'draw'",e.line,e.column)}parseClearCanvasStatement(){const e=this.consume(n.CLEAR,"Expected 'clear'");return this.consume(n.CANVAS,"Expected 'canvas' after 'clear'"),{type:"ClearCanvasStatement",line:e.line}}parseExpression(){return this.parseOr()}parseOr(){let e=this.parseAnd();for(;this.check(n.OR);){this.advance();const t=this.parseAnd();e={type:"BinaryExpression",operator:"or",left:e,right:t}}return e}parseAnd(){let e=this.parseComparison();for(;this.check(n.AND);){this.advance();const t=this.parseComparison();e={type:"BinaryExpression",operator:"and",left:e,right:t}}return e}parseComparison(){let e=this.parseJoined();if(this.check(n.IS)){this.advance();let t;if(this.check(n.EQUAL))this.advance(),this.consume(n.TO,"Expected 'to' after 'is equal'"),t="equal to";else if(this.check(n.GREATER))this.advance(),this.consume(n.THAN,"Expected 'than' after 'is greater'"),this.check(n.OR)?(this.advance(),this.consume(n.EQUAL,"Expected 'equal' after 'or'"),this.consume(n.TO,"Expected 'to' after 'equal'"),t="greater than or equal to"):t="greater than";else if(this.check(n.LESS))this.advance(),this.consume(n.THAN,"Expected 'than' after 'is less'"),this.check(n.OR)?(this.advance(),this.consume(n.EQUAL,"Expected 'equal' after 'or'"),this.consume(n.TO,"Expected 'to' after 'equal'"),t="less than or equal to"):t="less than";else if(this.check(n.NOT))this.advance(),this.consume(n.EQUAL,"Expected 'equal' after 'is not'"),this.consume(n.TO,"Expected 'to' after 'equal'"),t="not equal to";else{if(this.check(n.YES))return{type:"ComparisonExpression",operator:"equal to",left:e,right:{type:"BooleanLiteral",value:!0}};if(this.check(n.NO))return{type:"ComparisonExpression",operator:"equal to",left:e,right:{type:"BooleanLiteral",value:!1}};throw new l("Expected 'equal to', 'greater than', 'less than', or 'not equal to' after 'is'",this.peek().line,this.peek().column)}const i=this.parseJoined();return{type:"ComparisonExpression",operator:t,left:e,right:i}}return e}parseJoined(){let e=this.parseAdditive();for(;this.check(n.JOINED);){this.advance(),this.consume(n.WITH,"Expected 'with' after 'joined'");const t=this.parseAdditive();e={type:"JoinedExpression",left:e,right:t}}return e}parseAdditive(){let e=this.parseMultiplicative();for(;;){let t=null;if(this.check(n.PLUS)||this.check(n.PLUS_SYMBOL)?(this.advance(),t="plus"):(this.check(n.MINUS)||this.check(n.MINUS_SYMBOL))&&(this.advance(),t="minus"),t){const i=this.parseMultiplicative();e={type:"BinaryExpression",operator:t,left:e,right:i}}else break}return e}parseMultiplicative(){let e=this.parseUnary();for(;;){let t=null;if(this.check(n.TIMES_OP)||this.check(n.STAR)?(this.advance(),t="times"):this.check(n.TIMES)?(this.advance(),t="times"):this.check(n.DIVIDED)?(this.advance(),this.consume(n.BY,"Expected 'by' after 'divided'"),t="divided by"):this.check(n.SLASH)?(this.advance(),t="divided by"):this.check(n.MOD)&&(this.advance(),t="mod"),t){const i=this.parseUnary();e={type:"BinaryExpression",operator:t,left:e,right:i}}else break}return e}parseUnary(){return this.check(n.NOT)?(this.advance(),{type:"UnaryExpression",operator:"not",operand:this.parseUnary()}):this.check(n.MINUS_SYMBOL)?(this.advance(),{type:"UnaryExpression",operator:"minus",operand:this.parseUnary()}):this.parsePrimary()}parsePrimary(){if(this.check(n.NUMBER)){const t=this.advance();return{type:"NumberLiteral",value:parseFloat(t.value)}}if(this.check(n.STRING))return{type:"StringLiteral",value:this.advance().value};if(this.check(n.YES))return this.advance(),{type:"BooleanLiteral",value:!0};if(this.check(n.NO))return this.advance(),{type:"BooleanLiteral",value:!1};if(this.check(n.LIST)){this.advance(),this.consume(n.OF,"Expected 'of' after 'list'");const t=[];do t.push(this.parseExpression()),this.check(n.COMMA)&&this.advance(),this.check(n.AND)&&this.advance();while(!this.isAtEnd()&&!this.checkStatementStart()&&!this.check(n.END)&&this.check(n.NUMBER)||this.check(n.STRING)||this.check(n.IDENTIFIER)||this.check(n.YES)||this.check(n.NO));return{type:"ListLiteral",elements:t}}if(this.check(n.ITEM)){this.advance();const t=this.parseExpression();this.consume(n.OF,"Expected 'of' after item index");const i=this.parseExpression();return{type:"ItemAccess",index:t,list:i}}if(this.check(n.IDENTIFIER)){const t=this.advance();return this.check(n.WITH)?(this.current--,this.parseFunctionCallExpression()):{type:"Identifier",name:t.value}}const e=this.peek();throw new l(`I expected a value here but found '${e.value}'`,e.line,e.column)}check(e){return this.isAtEnd()?!1:this.peek().type===e}checkStatementStart(){return this.check(n.SET)||this.check(n.IF)||this.check(n.REPEAT)||this.check(n.FOR)||this.check(n.FUNCTION)||this.check(n.RETURN)||this.check(n.PRINT)||this.check(n.DRAW)||this.check(n.CLEAR)}advance(){return this.isAtEnd()||this.current++,this.previous()}isAtEnd(){return this.peek().type===n.EOF}peek(){return this.tokens[this.current]}peekNext(){return this.current+1>=this.tokens.length?null:this.tokens[this.current+1]}previous(){return this.tokens[this.current-1]}consume(e,t){if(this.check(e))return this.advance();const i=this.peek(),r=y(i.value,[e.toLowerCase()]),a=r?`Did you mean '${r}'?`:void 0;throw new l(t,i.line,i.column,a)}consumeOptionalComma(){this.check(n.COMMA)&&this.advance()}}function A(s){return new k(s).parse()}class v{constructor(e){this.value=e}}class R{constructor(e){this.globals=new Map,this.environment=this.globals,this.callbacks=e}run(e){for(const t of e.statements)this.executeStatement(t)}executeStatement(e){switch(e.type){case"SetStatement":this.executeSetStatement(e);break;case"IfStatement":this.executeIfStatement(e);break;case"RepeatTimesStatement":this.executeRepeatTimesStatement(e);break;case"RepeatWhileStatement":this.executeRepeatWhileStatement(e);break;case"ForEachStatement":this.executeForEachStatement(e);break;case"FunctionDeclaration":this.executeFunctionDeclaration(e);break;case"FunctionCallStatement":this.evaluateFunctionCall(e.call);break;case"ReturnStatement":this.executeReturnStatement(e);break;case"PrintStatement":this.executePrintStatement(e);break;case"DrawStatement":this.executeDrawStatement(e);break;case"SetColorStatement":this.executeSetColorStatement(e);break;case"ClearCanvasStatement":this.callbacks.clearCanvas();break;default:throw new o(`Unknown statement type: ${e.type}`,0)}}executeSetStatement(e){const t=this.evaluate(e.value);this.environment.set(e.identifier,t)}executeIfStatement(e){const t=this.evaluate(e.condition);if(this.isTruthy(t))for(const i of e.thenBranch)this.executeStatement(i);else if(e.elseBranch)for(const i of e.elseBranch)this.executeStatement(i)}executeRepeatTimesStatement(e){const t=this.evaluate(e.count);if(typeof t!="number")throw new o(`'repeat' needs a number, but got ${typeof t}`,e.line);for(let i=0;i<t;i++)for(const r of e.body)this.executeStatement(r)}executeRepeatWhileStatement(e){let t=0;const i=1e5;for(;this.isTruthy(this.evaluate(e.condition));){for(const r of e.body)this.executeStatement(r);if(t++,t>i)throw new o("This loop has run too many times. There might be an infinite loop.",e.line,1,"Check that your loop condition will eventually become false")}}executeForEachStatement(e){const t=this.evaluate(e.iterable);if(!Array.isArray(t))throw new o(`'for each' needs a list to loop over, but got ${typeof t}`,e.line);const i=this.environment;this.environment=new Map(i);for(const r of t){this.environment.set(e.variable,r);for(const a of e.body)this.executeStatement(a)}this.environment=i}executeFunctionDeclaration(e){const t={type:"function",name:e.name,parameters:e.parameters,body:e.body};this.globals.set(e.name,t)}executeReturnStatement(e){const t=e.value?this.evaluate(e.value):null;throw new v(t)}executePrintStatement(e){const t=this.evaluate(e.value);this.callbacks.print(this.stringify(t))}executeDrawStatement(e){const t=e.params;switch(e.shape){case"circle":{const i=this.evaluateNumber(t.x,"x",e.line),r=this.evaluateNumber(t.y,"y",e.line),a=this.evaluateNumber(t.radius,"radius",e.line);this.callbacks.drawCircle(i,r,a);break}case"rectangle":{const i=this.evaluateNumber(t.x,"x",e.line),r=this.evaluateNumber(t.y,"y",e.line),a=this.evaluateNumber(t.width,"width",e.line),c=this.evaluateNumber(t.height,"height",e.line);this.callbacks.drawRectangle(i,r,a,c);break}case"line":{const i=this.evaluateNumber(t.x1,"x1",e.line),r=this.evaluateNumber(t.y1,"y1",e.line),a=this.evaluateNumber(t.x2,"x2",e.line),c=this.evaluateNumber(t.y2,"y2",e.line);this.callbacks.drawLine(i,r,a,c);break}}}executeSetColorStatement(e){const t=this.evaluate(e.color);this.callbacks.setColor(String(t))}evaluate(e){switch(e.type){case"NumberLiteral":return e.value;case"StringLiteral":return e.value;case"BooleanLiteral":return e.value;case"Identifier":return this.lookupVariable(e.name);case"ListLiteral":return e.elements.map(t=>this.evaluate(t));case"ItemAccess":return this.evaluateItemAccess(e);case"BinaryExpression":return this.evaluateBinaryExpression(e);case"UnaryExpression":return this.evaluateUnaryExpression(e);case"ComparisonExpression":return this.evaluateComparisonExpression(e);case"JoinedExpression":return this.evaluateJoinedExpression(e);case"FunctionCallExpression":return this.evaluateFunctionCall(e);default:throw new o(`Unknown expression type: ${e.type}`,0)}}lookupVariable(e){if(this.environment.has(e))return this.environment.get(e);if(this.globals.has(e))return this.globals.get(e);throw new o(`I don't know what '${e}' is. Did you forget to set it first?`,0,1,`Try adding: set ${e} to ...`)}evaluateItemAccess(e){const t=this.evaluate(e.index),i=this.evaluate(e.list);if(typeof t!="number")throw new o(`The item number needs to be a number, but got ${typeof t}`,0);if(!Array.isArray(i))throw new o(`'item' can only be used with lists, but got ${typeof i}`,0);const r=Math.floor(t)-1;if(r<0||r>=i.length)throw new o(`There is no item ${t} in this list. The list has ${i.length} item(s).`,0,1,`Valid item numbers are 1 to ${i.length}`);return i[r]}evaluateBinaryExpression(e){const t=this.evaluate(e.left),i=this.evaluate(e.right);switch(e.operator){case"plus":if(typeof t=="number"&&typeof i=="number")return t+i;throw new o(`Cannot add ${typeof t} and ${typeof i}. Both sides need to be numbers.`,0);case"minus":if(typeof t=="number"&&typeof i=="number")return t-i;throw new o(`Cannot subtract ${typeof t} and ${typeof i}. Both sides need to be numbers.`,0);case"times":if(typeof t=="number"&&typeof i=="number")return t*i;throw new o(`Cannot multiply ${typeof t} and ${typeof i}. Both sides need to be numbers.`,0);case"divided by":if(typeof t=="number"&&typeof i=="number"){if(i===0)throw new o("Cannot divide by zero",0,1,"Division by zero is undefined in mathematics");return t/i}throw new o(`Cannot divide ${typeof t} by ${typeof i}. Both sides need to be numbers.`,0);case"mod":if(typeof t=="number"&&typeof i=="number")return t%i;throw new o(`Cannot use 'mod' with ${typeof t} and ${typeof i}. Both sides need to be numbers.`,0);case"and":return this.isTruthy(t)&&this.isTruthy(i);case"or":return this.isTruthy(t)||this.isTruthy(i);default:throw new o(`Unknown operator: ${e.operator}`,0)}}evaluateUnaryExpression(e){const t=this.evaluate(e.operand);switch(e.operator){case"not":return!this.isTruthy(t);case"minus":if(typeof t=="number")return-t;throw new o(`Cannot negate ${typeof t}. Expected a number.`,0);default:throw new o(`Unknown operator: ${e.operator}`,0)}}evaluateComparisonExpression(e){const t=this.evaluate(e.left),i=this.evaluate(e.right);switch(e.operator){case"equal to":return this.isEqual(t,i);case"not equal to":return!this.isEqual(t,i);case"greater than":if(typeof t=="number"&&typeof i=="number")return t>i;throw new o(`Cannot compare ${typeof t} and ${typeof i}. Both sides need to be numbers.`,0);case"less than":if(typeof t=="number"&&typeof i=="number")return t<i;throw new o(`Cannot compare ${typeof t} and ${typeof i}. Both sides need to be numbers.`,0);case"greater than or equal to":if(typeof t=="number"&&typeof i=="number")return t>=i;throw new o(`Cannot compare ${typeof t} and ${typeof i}. Both sides need to be numbers.`,0);case"less than or equal to":if(typeof t=="number"&&typeof i=="number")return t<=i;throw new o(`Cannot compare ${typeof t} and ${typeof i}. Both sides need to be numbers.`,0);default:throw new o(`Unknown comparison: ${e.operator}`,0)}}evaluateJoinedExpression(e){const t=this.evaluate(e.left),i=this.evaluate(e.right);return this.stringify(t)+this.stringify(i)}evaluateFunctionCall(e){const t=this.lookupVariable(e.name);if(!t||typeof t!="object"||t.type!=="function")throw new o(`'${e.name}' is not a function`,0,1,`Make sure you defined a function called '${e.name}'`);const i=t,r=e.arguments.map(h=>this.evaluate(h));if(r.length!==i.parameters.length)throw new o(`The function '${e.name}' needs ${i.parameters.length} value(s), but you gave it ${r.length}`,0);const a=this.environment;this.environment=new Map(this.globals);for(let h=0;h<i.parameters.length;h++)this.environment.set(i.parameters[h],r[h]);let c=null;try{for(const h of i.body)this.executeStatement(h)}catch(h){if(h instanceof v)c=h.value;else throw h}return this.environment=a,c}evaluateNumber(e,t,i){const r=this.evaluate(e);if(typeof r!="number")throw new o(`'${t}' needs to be a number, but got ${typeof r}`,i);return r}isTruthy(e){return e===null?!1:typeof e=="boolean"?e:!0}isEqual(e,t){return e===null&&t===null?!0:e===null||t===null?!1:Array.isArray(e)&&Array.isArray(t)?e.length!==t.length?!1:e.every((i,r)=>this.isEqual(i,t[r])):e===t}stringify(e){return e===null?"nothing":typeof e=="boolean"?e?"yes":"no":Array.isArray(e)?"list of "+e.map(t=>this.stringify(t)).join(", "):typeof e=="object"&&e.type==="function"?`function ${e.name}`:String(e)}}function C(s){return new R(s)}function D(s,e){const t=s.getContext("2d");let i="black";return{print(r){const a=document.createElement("div");a.textContent=r,e.appendChild(a),e.scrollTop=e.scrollHeight},drawCircle(r,a,c){t.beginPath(),t.arc(r,a,c,0,Math.PI*2),t.fillStyle=i,t.fill()},drawRectangle(r,a,c,h){t.fillStyle=i,t.fillRect(r,a,c,h)},drawLine(r,a,c,h){t.beginPath(),t.moveTo(r,a),t.lineTo(c,h),t.strokeStyle=i,t.lineWidth=2,t.stroke()},setColor(r){i=r},clearCanvas(){t.clearRect(0,0,s.width,s.height)}}}function L(s,e){try{const t=x(s),i=A(t);return C(e).run(i),{success:!0}}catch(t){if(t instanceof u)return{success:!1,error:{message:t.message,line:t.line,column:t.column,formatted:t.format(s)}};throw t}}const E={hello:`note: Welcome to Gently!
note: This is a simple Hello World program

print "Hello, World!"
print "Welcome to Gently programming language"

set name to "Friend"
print "Nice to meet you, " joined with name`,math:`note: Basic math operations in Gently

set a to 10
set b to 3

print "Math with " joined with a joined with " and " joined with b

set sum to a plus b
print "Sum: " joined with sum

set difference to a minus b
print "Difference: " joined with difference

set product to a times b
print "Product: " joined with product

set quotient to a divided by b
print "Quotient: " joined with quotient

set remainder to a mod b
print "Remainder: " joined with remainder

note: You can also use symbols
set result to 5 + 3 * 2
print "5 + 3 * 2 = " joined with result`,loops:`note: Different types of loops in Gently

print "Counting to 5:"
set counter to 1
repeat 5 times
    print counter
    set counter to counter plus 1
end repeat

print ""
print "Using a list:"
set fruits to list of "apple", "banana", "cherry"
for each fruit in fruits do
    print "I like " joined with fruit
end for

print ""
print "Countdown:"
set n to 5
repeat while n is greater than 0
    print n
    set n to n minus 1
end repeat
print "Blast off!"`,drawing:`note: Drawing shapes on the canvas
note: Click the "Canvas" tab to see the output!

clear canvas

note: Draw a blue sky
set color to "lightblue"
draw rectangle at 0, 0 with width 400 and height 200

note: Draw the sun
set color to "yellow"
draw circle at 350, 50 with radius 40

note: Draw grass
set color to "green"
draw rectangle at 0, 200 with width 400 and height 100

note: Draw a house
set color to "brown"
draw rectangle at 150, 120 with width 100 and height 80

note: Draw a roof
set color to "darkred"
draw line from 140, 120 to 200, 70
draw line from 200, 70 to 260, 120

note: Draw a door
set color to "saddlebrown"
draw rectangle at 185, 150 with width 30 and height 50

print "Drew a house scene!"
print "Click the Canvas tab to see it."`,function:`note: Functions in Gently

note: A simple greeting function
function greet taking name
    print "Hello, " joined with name joined with "!"
end function

greet with "Alice"
greet with "Bob"

note: A function that returns a value
function add taking a b
    return a plus b
end function

set result to add with 5 and 3
print "5 + 3 = " joined with result

note: A function to check if a number is even
function is_even taking number
    set remainder to number mod 2
    if remainder is equal to 0 then
        return yes
    end if
    return no
end function

set num to 4
if is_even with num then
    print num joined with " is even"
else
    print num joined with " is odd"
end if`},f=document.getElementById("editor"),w=document.getElementById("output"),d=document.getElementById("canvas"),O=document.getElementById("run-btn"),m=document.getElementById("examples"),p=document.getElementById("error"),S=document.querySelectorAll(".tab"),F=document.querySelectorAll(".panel");S.forEach(s=>{s.addEventListener("click",()=>{var t;const e=s.getAttribute("data-tab");S.forEach(i=>i.classList.remove("active")),F.forEach(i=>i.classList.remove("active")),s.classList.add("active"),(t=document.getElementById(`${e}-panel`))==null||t.classList.add("active")})});m.addEventListener("change",()=>{const s=m.value;s&&E[s]&&(f.value=E[s],m.value="")});function b(){w.innerHTML="",p.classList.add("hidden"),p.textContent="",d.getContext("2d").clearRect(0,0,d.width,d.height);const e=f.value;if(!e.trim())return;const t=D(d,w),i=L(e,t);!i.success&&i.error&&(p.textContent=i.error.formatted,p.classList.remove("hidden"))}O.addEventListener("click",b);f.addEventListener("keydown",s=>{(s.ctrlKey||s.metaKey)&&s.key==="Enter"&&(s.preventDefault(),b())});f.value=E.hello;
